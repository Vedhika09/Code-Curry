{% extends 'base.html' %}
{% load static %}
{% block main %}

<section class="vh-100 gradient-custom">
  <div class="container py-5 h-100">
    <div class="card bg-dark text-white" style="border-radius: 1rem;">
      <div class="card-body p-5">
        <div class="row d-flex justify-content-center align-items-center h-100">

          <h2 class="fw-bold mb-2 text-uppercase text-center"> Sign Up</h2>
          <p class="text-white-50 mb-2 text-center">Please enter following details</p>

          <!-- Progressbar -->
          <div class="progressbar mb-4">
            <div class="progress-step progress-step-active">Step 1</div>
            <div class="progress-step">Step 2</div>
          </div>

          <form action="" method="post" enctype="multipart/form-data" novalidate>
            {% csrf_token %}

            <!-- Step 1 -->
            <div class="form-step form-step-active">
              {% for fm in form1 %}
                <div class="form-group col-sm-12 p-2">
                  {{fm.label_tag}} {{fm}} 
                  <small class="text-danger">{{fm.errors|striptags}}</small>
                </div>
              {% endfor %}
              <div class="d-grid gap-2">
                <button type="button" class="btn btn-primary next-step mt-3">Next</button>
              </div>
            </div>

            <!-- Step 2 -->
            <div class="form-step">
              {% for fm in form2 %}
                <div class="form-group col-sm-12 p-2">
                  {{fm.label_tag}} {{fm}} 
                  <small class="text-danger">{{fm.errors|striptags}}</small>
                </div>
              {% endfor %}
              <div class="d-grid gap-2">
                <button type="button" class="btn btn-secondary prev-step mt-3">Previous</button>
                <input type="submit" value="Submit" class="btn btn-success mt-3">
              </div>
            </div>

            <!-- Login link -->
            <div class="mt-4 px-3 text-center">
              <p class="mb-0">Already have an account? 
                <a href="{% url 'login_donor' %}" class="text-white-50 fw-bold">Login</a>
              </p>
            </div>

            {% if form.non_field_errors %}
              {% for error in form.non_field_errors %}
                <p class="alert alert-danger my-3">{{error}}</p>
              {% endfor %}
            {% endif %}
          </form>

          {% if messages %}
            {% for message in messages %}
              <p {% if message.tags %} class="alert alert-{{message.tags}} my-5" {% endif %}> {{message}}</p>
            {% endfor %}
          {% endif %}

        </div>
      </div>
    </div>
  </div>
</section>

<!-- Stepper Script + Styling -->
<style>
  .form-step { display: none; }
  .form-step-active { display: block; }
  .progressbar { display: flex; justify-content: space-between; counter-reset: step; }
  .progress-step { width: 100%; text-align: center; position: relative; }
  .progress-step::before {
    content: counter(step);
    counter-increment: step;
    width: 30px; height: 30px; line-height: 30px;
    border: 1px solid #0d6efd; display: inline-block;
    border-radius: 50%; background-color: #f3f3f3; color: #000;
  }
  .progress-step-active::before {
    background-color: #0d6efd; color: #fff;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const steps = document.querySelectorAll(".form-step");
    const nextBtns = document.querySelectorAll(".next-step");
    const prevBtns = document.querySelectorAll(".prev-step");
    const progressSteps = document.querySelectorAll(".progress-step");
    let step = 0;

    nextBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        steps[step].classList.remove("form-step-active");
        progressSteps[step].classList.remove("progress-step-active");
        step++;
        steps[step].classList.add("form-step-active");
        progressSteps[step].classList.add("progress-step-active");
      });
    });

    prevBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        steps[step].classList.remove("form-step-active");
        progressSteps[step].classList.remove("progress-step-active");
        step--;
        steps[step].classList.add("form-step-active");
        progressSteps[step].classList.add("progress-step-active");
      });
    });
  });
</script>

{% endblock main %}
