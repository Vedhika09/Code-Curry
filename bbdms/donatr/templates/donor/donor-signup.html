{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - BBDMS</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/kaiadmin.min.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/plugins.min.css' %}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
      .form-step {
        display: none;
      }
      .form-step-active {
        display: block;
      }
      .progressbar {
        display: flex;
        justify-content: space-between;
        counter-reset: step;
      }
      .progress-step {
        width: 100%;
        text-align: center;
        position: relative;
      }
      .progress-step::before {
        content: counter(step);
        counter-increment: step;
        width: 30px;
        height: 30px;
        line-height: 30px;
        border: 1px solid #007bff;
        display: inline-block;
        border-radius: 50%;
        background-color: #f3f3f3;
      }
      .progress-step-active::before {
        background-color: #007bff;
        color: white;
      }
      .card {
        background-color: rgba(255, 255, 255, 0.85); /* semi-transparent white */
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      }
    </style>
  </head>
  <body style="position: relative; overflow: hidden;">

    <!-- Video Background -->
    <video autoplay muted loop playsinline id="bgVideo"
           style="position: fixed; right: -10%; bottom: -30%;
                  min-width: 100%; min-height: 100%;
                  z-index: -1; object-fit: cover;">
      <source src="{% static 'assets/img/bgv.mp4' %}" type="video/mp4">
      Your browser does not support the video tag.
    </video>

    <div class="container mt-5">
      <div class="card">
        <div class="card-header text-center">
          <h4>Register with Us!</h4>
        </div>
        <div class="card-body">
          <div class="progressbar mb-4">
            <div class="progress-step progress-step-active">Step 1</div>
            <div class="progress-step">Step 2</div>
            <div class="progress-step">Step 3</div>
          </div>
          <form method="POST" enctype="multipart/form-data" action="{% url 'donor_signup' %}">
            {% csrf_token %}

            <!-- Step 1 -->
            <div class="form-step form-step-active">
              <div class="mb-3">
                <label for="pic">Profile Pic</label>
                <input type="file" class="form-control" name="pic" required />
              </div>
              <div class="mb-3">
                <label for="first_name">First Name</label>
                <input type="text" class="form-control" name="first_name" required />
              </div>
              <div class="mb-3">
                <label for="last_name">Last Name</label>
                <input type="text" class="form-control" name="last_name" required />
              </div>
              <div class="mb-3">
                <label for="mobno">Mobile Number</label>
                <input type="text" class="form-control" name="mobno" maxlength="10" pattern="[0-9]+" required />
              </div>
              <div class="mb-3">
                <label for="age">Age</label>
                <input type="number" class="form-control" name="age" required />
              </div>
              <button type="button" class="btn btn-primary next-step">Next</button>
            </div>

            <!-- Step 2 -->
            <div class="form-step">
              <div class="mb-3">
                <label for="bg_id">Blood Group</label>
                <select class="form-control" name="bg_id" required>
                  <option value="">Choose Blood Group</option>
                  {% for i in bg %}
                    <option value="{{ i.id }}">{{ i.bloodgroup }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3">
                <label for="location">Location (Start typing city)</label>
                <input type="text" id="location" class="form-control" name="location" list="cities" required />
                <datalist id="cities">
                  <option value="Bangalore">
                  <option value="Mumbai">
                  <option value="Chennai">
                  <option value="Delhi">
                  <option value="Kolkata">
                </datalist>
              </div>
              <div class="mb-3">
                <label for="gender">Gender</label>
                <select class="form-control" name="gender" required>
                  <option value="">Select</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <button type="button" class="btn btn-secondary prev-step">Previous</button>
              <button type="button" class="btn btn-primary next-step">Next</button>
            </div>

            <!-- Step 3 -->
            <div class="form-step">
              <div class="mb-3">
                <label for="username">Username</label>
                <input type="text" class="form-control" name="username" required />
              </div>
              <div class="mb-3">
                <label for="email">Email</label>
                <input type="email" class="form-control" name="email" required />
              </div>
              <div class="mb-3">
                <label for="password">Password</label>
                <input type="password" class="form-control" name="password" required />
              </div>
              <div class="mb-3">
                <label for="confirm_password">Confirm Password</label>
                <input type="password" class="form-control" name="confirm_password" required />
              </div>
              <div class="mb-3">
                <label for="address">Address</label>
                <textarea class="form-control" name="address" rows="3" required></textarea>
              </div>
              <button type="button" class="btn btn-secondary prev-step">Previous</button>
              <button type="submit" class="btn btn-success">Register</button>
            </div>

            <div class="text-center mt-3">
              <a href="{% url 'login' %}" class="btn btn-outline-primary me-2"><i class="bi bi-box-arrow-in-right"></i> Sign In</a>
              <a href="{% url 'index' %}" class="btn btn-outline-secondary"><i class="bi bi-house"></i> Home Page</a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const steps = document.querySelectorAll(".form-step");
        const nextBtns = document.querySelectorAll(".next-step");
        const prevBtns = document.querySelectorAll(".prev-step");
        const progressSteps = document.querySelectorAll(".progress-step");

        let step = 0;

        function validateStep(currentStep) {
          const inputs = steps[currentStep].querySelectorAll("input, select, textarea");

          for (let input of inputs) {
            if (!input.checkValidity()) {
              input.reportValidity();
              return false;
            }

            const nameRegex = /^[A-Za-z\s]+$/;
            if ((input.name === "first_name" || input.name === "last_name") && !nameRegex.test(input.value.trim())) {
              alert("Please use only characters for names.");
              input.focus();
              return false;
            }

            if (input.name === "mobno" && !/^\d{10}$/.test(input.value.trim())) {
              alert("Please enter a valid 10-digit mobile number.");
              input.focus();
              return false;
            }
          }

          return true;
        }

        nextBtns.forEach((btn) => {
          btn.addEventListener("click", () => {
            if (validateStep(step) && step < steps.length - 1) {
              steps[step].classList.remove("form-step-active");
              progressSteps[step].classList.remove("progress-step-active");
              step++;
              steps[step].classList.add("form-step-active");
              progressSteps[step].classList.add("progress-step-active");
            }
          });
        });

        prevBtns.forEach((btn) => {
          btn.addEventListener("click", () => {
            if (step > 0) {
              steps[step].classList.remove("form-step-active");
              progressSteps[step].classList.remove("progress-step-active");
              step--;
              steps[step].classList.add("form-step-active");
              progressSteps[step].classList.add("progress-step-active");
            }
          });
        });
      });
    </script>

  </body>
</html>
